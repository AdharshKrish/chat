<!DOCTYPE html>
<html>
<head>
    <title>Global Chat</title>
    <link rel="stylesheet" href="bootstrap4.css">
    <link rel="icon" href="favicon.ico">
</head>

<body>
<div class="container" style="padding-top: 50px">
    <div class="input-group mb-3">
        <input type="text" class="form-control" id="chat" placeholder="Enter text here..." aria-label="Recipient's username" aria-describedby="basic-addon2">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" id="publish-button" type="button" id="button-addon2">Send</button>
        </div>
    </div>
    <ul class="list-group" id="globe"></ul>
</div>
</body>

<script src="pubnub.4.21.6.min.js"></script>
<script>
const pubnub = new PubNub({
    publishKey: "pub-c-61c84398-283c-4923-a72e-e6804586a45a",
    subscribeKey: "sub-c-5c18f472-5eb1-11ea-b7ea-f2f107c29c38"
});

const button = document.getElementById('publish-button');
const input = document.getElementById("chat");
button.addEventListener('click', () => {
    let d = new Date();
    pubnub.publish({
        channel : 'time-publish-example-channel',
        message: {
            mytime: (d.getHours()>12?d.getHours()-12:d.getHours())+':'+d.getMinutes()+':'+d.getSeconds()+'&emsp;'+d.getDate()+'/'+(d.getMonth()+1)+'/'+d.getFullYear(),
            chat: input.value
        }
    }, function(status, response) {
        console.error(status, response);
    })
    input.value='';
});
input.addEventListener("keyup", function(event) {
  if (event.keyCode === 13) {
    event.preventDefault();
    button.click();
  }
});

pubnub.subscribe({
    channels: ['time-publish-example-channel']
});

pubnub.addListener({
    message: function(event) {
        window.globe.innerHTML += '<li class="list-group-item d-flex justify-content-between align-items-center">'+event.message.chat+'<span class="badge badge-primary badge-pill">'+event.message.mytime+'</span></li>';
    }
});


</script>
</html>
